<div class="container" id="index-page">
  {{> message}}
  <div id="data-panel" class="mb-3">
    <div id="total-amount-wrapper" class="d-flex flex-wrap align-items-start">
      <span class="total-amount-title mr-2">總金額</span>
      <span id="total-amount" class="text-danger">{{ numberFormat totalAmount }}</span>
    </div>
  </div>

  {{!-- filtering --}}
  <form action="/" method="GET" id="filter-form" class="mb-1">
    <div class="d-flex mb-3 justify-content-between">
      <a href="/records/new" class="btn btn-info"> + 支出</a>
      <div class="d-flex">
        <button type="reset" class="btn btn-light mr-1 clear-filter">
          <i class="fas fa-filter"></i>
        </button>
        <select class="form-control mr-1" id="category" name="category">
          <option value="all" {{#if (eq "all" ../category)}}selected{{/if}}>All</option>
          {{#each categories}}
          <option value="{{ this.name }}" {{#if (eq this.name ../category)}}selected{{/if}}>{{ this.name }}
          </option>
          {{/each}}
        </select>
        <input type="month" class="form-control mr-1" id="month" name="month" value="{{month}}">
        <input type="hidden" id="utc-offset" name="utcOffset">
        <select type="text" class="form-control mr-1" name="sort" id="sort">
          <option value="date-asc" {{#if (eq sort 'date-asc' )}}selected{{/if}}>日期: 舊 - 新</option>
          <option value="date-desc" {{#if (eq sort 'date-desc' )}}selected{{/if}}>日期: 新 - 舊</option>
          <option value="amount-desc" {{#if (eq sort 'amount-desc' )}}selected{{/if}}>金額: 大 - 小</option>
          <option value="amount-asc" {{#if (eq sort 'amount-asc' )}}selected{{/if}}>金額: 小 - 大</option>
        </select>
        <input type="search" class="form-control mr-1" placeholder="搜尋支出名稱..." id="search" name="search"
          value="{{ search }}">
      </div>
    </div>

    {{!-- error message --}}
    <p class="col text-muted mt-2 text-center">{{ error }}</p>

  </form>

  <ul class="list-group">
    {{#each records}}
    <li class="list-group-item">
      <div class="record-wrapper d-flex justify-content-between">
        <div class="left-item-info d-flex flex-grow-1 justify-content-between align-items-center">
          <i class="{{ this.category.iconClass }} category col-1" title="{{ this.category.name }}" data-toggle="tooltip"
            data-placement="bottom"></i>
          <div class="middle-info col-7 col-md-9 pl-4">
            <div class="name">{{ this.name }}</div>
            <div class="date-field" data-timestamp="{{ this.date }}"></div>
          </div>
          <div class="amount col-3 col-md-2 text-right">{{ numberFormat this.amount }}</div>
        </div>
        <div class="right-btn-group d-flex align-items-center justify-content-end">
          <a href="/records/edit/{{ this._id }}" class="btn btn-record"><i class="fas fa-edit"></i></a>
          <form action="/records/{{ this._id }}?_method=DELETE" method="POST" style="display: inline;"
            class="delete-form" data-timestamp="{{ this.date }}" onsubmit="return confirm(`確定要刪除這筆支出嗎?
              名稱: {{ this.name }}
              日期: ${new Date(Number(this.dataset.timestamp)).toISOString().slice(0, 10)}
              金額: {{ numberFormat this.amount }}`)">
            <button class="btn btn-record"><i class="fas fa-trash-alt"></i></button>
          </form>
        </div>
      </div>

    </li>
    {{/each}}
  </ul>
</div>